<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1.0">

    <title>Photobooth</title>
    <link rel="stylesheet" href="/static/css/photobooth.css">
    <style>
        video, canvas {
            /** flip the x-axis of the vid **/
            transform: scaleX(-1);
            -webkit-transform: scaleX(-1);
            width: 640px;
            height: 480px;
        }
        div#vidstream {
            position: relative;
        }
        canvas#overlayCanvas {
            position: absolute;
            left: 0;
        }
        canvas#animationCanvas {
            position: absolute;
            left: 0;
            top: 0;
        }
    </style>
    <script src="/mqtt.js"></script>
    <script src="/static/js/three.min.js"></script>
    <script src="/static/js/tracking.js"></script>
    <script src="/static/js/data/face-min.js"></script>
    <script src="/static/js/headtrackr.js"></script>
    <script src="/static/js/libs.js"></script>
    <script src="/static/js/messaging.js"></script>

</head>
<body>
    <div id="main">
        <div id="vidstream">
            <video id="inputVideo" width="640" height="480" autoplay loop style="z-order: 1;"></video>
            <canvas id="overlayCanvas" width="640" height="480" style="z-order: 5;"></canvas>
            <canvas id="animationCanvas" width="640" height="480" style="z-order: 10;"></canvas>
            <canvas id="outputCanvas" width="640" height="480" style="display: none"></canvas>
        </div>

        <script type="text/javascript">
            var inputVideo = document.getElementById('inputVideo');

            var animationCanvas = document.getElementById('animationCanvas');

            var overlayCanvas = document.getElementById('overlayCanvas');
            var octx = overlayCanvas.getContext('2d');

            var outputCanvas = document.getElementById('outputCanvas');
            var outctx = outputCanvas.getContext('2d');

            // set the output to be flipped (this makes output like a mirror)
            outctx.translate(outputCanvas.width, 0);
            outctx.scale(-1, 1);

            var faces = new tracking.ObjectTracker(['face']);
            faces.setInitialScale(4);
            faces.setStepSize(2);
            faces.setEdgesDensity(0.1);

            faces.on('track', function(event) {
  				if (event.data.length === 0) {
    				// No objects were detected in this frame.
  				} else {
                    heads = event.data;
  				}
			});

			tracking.track(inputVideo, faces, { camera: true });

            // start up the animation etc.
            three_init();
			animate();

        </script>

        <p><a onclick="do_countdown()">Take Snapshot</a></p>
        <p id="countdown"></p>
        <div id="result"></div>

</body>
</html>
